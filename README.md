# UNIVERSIDAD NACIONAL DE INGENIER√çA  
## FACULTAD DE INGENIER√çA INDUSTRIAL Y DE SISTEMAS  

**‚ÄúNETTALCO‚Äù**  

**Curso:** SI807-U SISTEMA DE INTELIGENCIA DE NEGOCIOS  
**Grupo 5**  

**Integrantes:**  
- Grijalva Parra, Francisco Leonel ‚Äì 20220071I  
- Loayza Segura, Roger Salvador ‚Äì 20220018K  
- Otero Vicente, Daniel Mauricio ‚Äì 20220288H  

**Profesor:** Dr. Ing. Aradiel Castaneda, Hilario  
**Ciclo:** 2025-II  

---

## 1. Generalidades de la empresa  

### 1.1 Nombre o raz√≥n social de la empresa  
**NETTALCO S.A. ‚Äì RUC 20100064571**

### 1.2 Giro de la empresa  
Nettalco es una empresa textil y de confecciones verticalmente integrada, localizada en Lima, Per√∫. Se dedica a la producci√≥n y exportaci√≥n de prendas de tejido de punto de algod√≥n y mezclas, por encargo de clientes internacionales. Act√∫a como *contract manufacturer*, elaborando prendas de vestir conforme a los dise√±os y especificaciones de sus clientes.  

### 1.3 Ubicaci√≥n de la empresa  
**Ca. Cinco 115 Urb. Vulcano, Ate ‚Äì Lima, Per√∫**

### 1.4 Misi√≥n y Visi√≥n  
- **Misi√≥n:** Brindar un producto y servicio de calidad a nuestros clientes basados en los m√°s altos est√°ndares internacionales.  
- **Visi√≥n:** Posicionarnos como empresa peruana exportadora de prendas de vestir l√≠der como *contract manufacturer* a nivel mundial.  

### 1.5 Productos y clientes  
**Productos:**  
- Prendas con hilados 100% de algod√≥n: Pima Peruano, Supima, Upland y Algod√≥n Org√°nico.  
- Mezclas con fibras como LYCRA¬Æ, Poli√©ster, Micromodal, Bamboo.  

**Clientes:**  
- Lands‚ÄôEnd  
- L.L.Bean  
- Hanna Andersson  
- Lacoste  
- The Company Store  
- Smaller Things  
- Radmor  
- Ricardo Almeida  

### 1.6 Organigrama  
<img width="879" height="593" alt="image" src="https://github.com/user-attachments/assets/0e5bf333-e824-48b3-b4d5-496895994e17" />


### 1.7 Mapa de procesos y subprocesos  
<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115414.png" />


### 1.8 Cadena de valor  
La cadena de valor de Nettalco est√° integrada verticalmente, controlando desde la obtenci√≥n de materias primas hasta la entrega final.  

**Actividades primarias:**  
- Producci√≥n y abastecimiento de materia prima.  
- Dise√±o y desarrollo de productos.  
- Fabricaci√≥n y confecci√≥n.  
- Control de calidad.  
- Distribuci√≥n y log√≠stica.  

**Actividades de soporte:**  
- Gesti√≥n tecnol√≥gica.  
- Recursos humanos.  
- Infraestructura.  
- Compras y aprovisionamiento.  

### 1.9 Modelo de negocio  
*(Pendiente)*  

---

## 2. Identificaci√≥n de Problemas del Negocio  

### 2.1 Problem√°tica  

**Internacional:**  
- Competencia global con precios bajos (China, India, Bangladesh).  
- Fluctuaciones en el costo del algod√≥n.  
- Tendencias de sostenibilidad y responsabilidad social.  

**Nacional (Per√∫):**  
- Acceso limitado a tecnolog√≠as avanzadas.  
- Infraestructura log√≠stica deficiente.  
- Competencia interna en la industria textil.  

**Local (Lima):**  
- Limitada mano de obra calificada.  
- Demanda creciente de sostenibilidad.  
- Altos costos operativos (log√≠stica, transporte, regulaciones).  

### 2.2 Formulaci√≥n del problema  

**Problema general:**  
Nettalco enfrenta un aumento significativo en los costos de las telas, reduciendo su capacidad de producci√≥n y cumplimiento de plazos de entrega.  

**Problemas espec√≠ficos:**  
- **Internacional:** Aumento de precios internacionales de materias primas.  
- **Nacional:** Escasez de proveedores locales confiables.  
- **Local:** Procesos manuales sin suficiente automatizaci√≥n.  

**Justificaci√≥n:**  
El incremento en el costo de telas y la falta de automatizaci√≥n amenazan la rentabilidad, competitividad y cumplimiento de contratos internacionales.  

---

## 3. Necesidades de Informaci√≥n y Decisiones Cr√≠ticas  

| Nivel       | Tipo de decisi√≥n | Necesidad de informaci√≥n |
|-------------|------------------|---------------------------|
| Estrat√©gico | Competitividad, expansi√≥n, sostenibilidad | Costos de producci√≥n, rentabilidad por cliente, proyecciones de demanda |
| T√°ctico     | Planificaci√≥n en producci√≥n, log√≠stica, clientes | Cumplimiento de plazos, eficiencia operativa, cadena de suministro |
| Operativo   | Procesos y control de calidad | Tasa de defectos, tiempos de producci√≥n, utilizaci√≥n de maquinaria, inventarios |

---

## 4. KPI‚Äôs iniciales  

### 4.1 KPIs de Producci√≥n  

| KPI | Definici√≥n | F√≥rmula | Unidad | Frecuencia | Sem√°foro |
|-----|------------|---------|--------|------------|----------|
| Tasa de defectos | % de prendas defectuosas | (Defectuosas / Total) * 100 | % por lote | Diario | ‚úÖ ‚â§2%, üü° 3‚Äì5%, üî¥ >5% |
| Tiempo de producci√≥n por lote | Tiempo total hasta producto final | Horas totales / N¬∫ de lotes | Horas/lote | Diario | ‚úÖ ‚â§48h, üü° 49‚Äì72h, üî¥ >72h |
| Utilizaci√≥n de maquinaria | % tiempo activo | (Tiempo activo / Tiempo total) * 100 | % | Semanal | ‚úÖ ‚â•85%, üü° 70‚Äì84%, üî¥ <70% |

### 4.2 KPIs de Cadena de Suministro  

| KPI | Definici√≥n | F√≥rmula | Unidad | Frecuencia | Sem√°foro |
|-----|------------|---------|--------|------------|----------|
| Tiempo de entrega de materia prima | Pedido ‚Üí llegada a planta | Recepci√≥n ‚Äì Pedido | D√≠as | Mensual | ‚úÖ ‚â§5, üü° 6‚Äì10, üî¥ >10 |
| Costo de transporte y log√≠stica | % sobre costo total | (Gastos log√≠stica / Costo total) * 100 | % o USD/unidad | Mensual | ‚úÖ ‚â§5%, üü° 6‚Äì10%, üî¥ >10% |

### 4.3 KPIs de Ventas y Clientes  

| KPI | Definici√≥n | F√≥rmula | Unidad | Frecuencia | Sem√°foro |
|-----|------------|---------|--------|------------|----------|
| Cumplimiento de plazos | % pedidos a tiempo | (Pedidos a tiempo / Total) * 100 | % | Semanal | ‚úÖ ‚â•95%, üü° 85‚Äì94%, üî¥ <85% |
| Satisfacci√≥n del cliente | Encuestas 1‚Äì10 | Promedio | Puntos | Trimestral | ‚úÖ ‚â•8, üü° 6‚Äì7, üî¥ ‚â§5 |
| Volumen de ventas por regi√≥n/cliente | Comparaci√≥n de pedidos | Œ£ Pedidos por regi√≥n/cliente | N¬∫ pedidos / USD | Mensual | Meta definida |

### 4.4 KPIs Financieros  

| KPI | Definici√≥n | F√≥rmula | Unidad | Frecuencia | Sem√°foro |
|-----|------------|---------|--------|------------|----------|
| Margen de utilidad por producto | (Precio ‚Äì Costo) / Precio * 100 | % de margen | % | Mensual | ‚úÖ ‚â•30%, üü° 20‚Äì29%, üî¥ <20% |
| Costo por unidad producida | Costo total / Unidades | USD/prenda | USD/prenda | Mensual | ‚úÖ ‚â§10, üü° 11‚Äì15, üî¥ >15 |

---



## 5. Evidencia Tecnica - Parte 1

### 5.1 Implementaci√≥n de HortonWorks 

#### 5.1.1 Capturas de pantalla de la VM mostrando:

##### Caracteristicas del sistema e inicializacion

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 114953.png" />

##### modificaci√≥n de contrase√±as

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115026.png" />

##### Servicios en ejecucion en Ambari

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115053.png" />

##### Version de Spark

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115120.png" />

##### Servicio HDFS y HIVE

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115200.png" />

### 5.2 Diagrama de Arquitectura Inicial  

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-09-24 115254.png" />

## 6. Preguntas del Negocio

| √Årea                  | Rol del Usuario                  | Pregunta de Negocio                                                                                   | Nivel de Prioridad | Fuente de Datos Actual         |
|-----------------------|----------------------------------|--------------------------------------------------------------------------------------------------------|--------------------|--------------------------------|
| Ventas y Marketing    | Gerente de Ventas / Marketing    | ¬øC√≥mo mejorar las ventas por canal? / ¬øQu√© canal genera mayor rendimiento? / ¬øQu√© campa√±as han generado mayor ROI? | Alta               | CRM, Sistema de Ventas         |
| Inventario y Log√≠stica| Gerente de Inventario / Producci√≥n | ¬øC√≥mo optimizar niveles de inventario? / ¬øQu√© productos tienen exceso o escasez? / ¬øC√≥mo predecir demanda? | Alta               | Sistema de Inventario y Log√≠stica |
| Clientes              | Gerente de Ventas / Asistente de Ventas | ¬øQui√©nes son los mejores clientes y c√≥mo retenerlos? / ¬øQu√© clientes han disminuido compras? / ¬øC√≥mo mejorar la satisfacci√≥n del cliente? | Alta | CRM, Sistema de Ventas |
| Finanzas y Rentabilidad | Gerente de Finanzas             | ¬øQu√© productos son m√°s rentables? / ¬øCu√°l es el margen de beneficio por producto? / ¬øC√≥mo optimizar flujo de caja? | Alta | ERP, Sistema Contable |
| Operaciones           | Gerente de Producci√≥n            | ¬øC√≥mo mejorar la eficiencia operativa? / ¬øD√≥nde est√°n los cuellos de botella?                           | Media              | ERP, Sistema de Producci√≥n     |
| Planificaci√≥n Estrat√©gica | Alta Gerencia                 | ¬øC√≥mo proyectar ventas futuras? / ¬øQu√© factores afectan m√°s nuestras proyecciones?                      | Media              | Datos Hist√≥ricos de Ventas     |

---

## 7. KPI‚Äôs definidos (Log√≠stica, Producci√≥n, Calidad y RRHH)

Con estas preguntas defninimos los KPI‚Äôs:

| Nombre                    | KPI                 | Descripci√≥n                                              | F√≥rmula                                    | Unidad             | Periodicidad   | Fuente de Datos              | Responsable            |
|---------------------------|---------------------|----------------------------------------------------------|--------------------------------------------|--------------------|----------------|------------------------------|------------------------|
| Rotaci√≥n de Inventario    | Inventario / Log√≠stica | Mide cu√°ntas veces se vende y repone el inventario       | Costo de Ventas / Inventario Promedio      | Veces              | Mensual        | Sistema de Inventario        | Gerente de Inventario  |
| D√≠as de Inventario Disponible | Inventario / Log√≠stica | Promedio de d√≠as que los productos permanecen en stock   | Inventario Promedio / (Costo Ventas / 365) | D√≠as               | Mensual        | Sistema de Inventario        | Gerente de Inventario  |
| Stock Cr√≠tico             | Inventario / Log√≠stica | Identifica productos por debajo del nivel m√≠nimo requerido | ‚Äî                                          | Unidades           | Diario/Semanal | Sistema de Inventario        | Gerente de Inventario  |
| Tiempo de Ciclo de Reabastecimiento | Log√≠stica        | Tiempo desde la solicitud hasta la disponibilidad        | Fecha Disponibilidad ‚Äì Fecha Pedido        | D√≠as               | Mensual        | Sistema de Log√≠stica y Proveedores | Gerente de Log√≠stica |
| Tiempo Promedio de Producci√≥n | Producci√≥n          | Tiempo promedio necesario para fabricar cada prenda       | Œ£ Horas / N¬∫ Prendas                       | Horas              | Diario/Mensual | Sistema de Producci√≥n        | Gerente de Producci√≥n |
| √çndice de Eficiencia de Producci√≥n | Producci√≥n       | % de productos terminados vs planificados                | (Prendas Terminadas / Prendas Planificadas) * 100 | %          | Mensual        | ERP / Producci√≥n             | Gerente de Producci√≥n |
| Tasa de Desperdicio       | Producci√≥n / Calidad | Proporci√≥n de material desperdiciado en la producci√≥n    | Material Desperdiciado / Material Total * 100 | %              | Mensual        | ERP / Producci√≥n             | Gerente de Producci√≥n |
| Incidentes de Riesgo Operativo | Calidad / Producci√≥n | N√∫mero de incidentes que afectan las operaciones         | Conteo de incidentes registrados           | N¬∫                 | Mensual        | Sistema de Riesgos / Producci√≥n | Jefe de Calidad      |
| Conformidad Regulatoria   | Calidad             | Nivel de cumplimiento normativo                          | N¬∫ Cumplimientos / N¬∫ Total Requisitos * 100 | %               | Trimestral     | Sistema de Cumplimiento      | Jefe de Calidad       |
| Satisfacci√≥n del Personal | RRHH                | Nivel de satisfacci√≥n de empleados en encuestas internas | Œ£ Puntuaciones / N¬∫ Encuestados            | %                  | Semestral      | Sistema de RRHH              | Gerente de RRHH       |
| Productividad del Personal | RRHH               | Medida de prendas producidas por trabajador              | Prendas Totales / N¬∫ Trabajadores          | Unidades/Empleado  | Mensual        | Sistema de RRHH / Producci√≥n | Gerente de RRHH       |

---

## 8. Modelado preliminar

### 8.1. Modelado conceptual preliminar

En base a la informaci√≥n planteamos el siguiente modelo conceptual:

<img width="886" height="373" alt="image" src="Captura de pantalla 2025-10-01 121833.png" />

Captura de pantalla 2025-10-01 121833
---

### 8.2. Modelo l√≥gico (Star Schema)

Recordemos que:

#### Tablas de dimensiones
Todas las tablas de dimensiones deben contener informaci√≥n clara y categorizada que permita an√°lisis detallados. Esto incluye:

- **Dim_Producto**: Contendr√° jerarqu√≠as de producto como tipo de tela, categor√≠a de prenda, color, etc.  
- **Dim_Tiempo**: Deber√° estar estructurada con atributos de granularidad temporal (d√≠a, mes, trimestre, a√±o).  
- **Dim_Cliente**: Agrupar√° datos por regi√≥n, pa√≠s, segmento de mercado, etc.  
- **Dim_Empleado** y **Dim_M√°quina**: Con informaci√≥n sobre el personal y los equipos para analizar eficiencia en producci√≥n.  

#### Tablas de hechos
Las tablas de hechos deben estar dise√±adas para facilitar el an√°lisis a distintos niveles de detalle, por ejemplo:  

- Ventas por categor√≠a de producto.  
- Inventario a lo largo del tiempo.  

<img width="795" height="584" alt="image" src="https://github.com/user-attachments/assets/564fedf7-ba07-496d-a13c-9d61a8a10a97" />

## 9. Inventario de fuentes OLTP

Durante la revisi√≥n de la fuente de datos, se verific√≥ que la informaci√≥n recopilada proviene de fuentes confiables y autorizadas. Se comprob√≥ la coherencia, precisi√≥n y completitud de los datos para asegurar su validez en el an√°lisis. Adicionalmente, se evalu√≥ la calidad de los datos considerando su relevancia y actualidad para el prop√≥sito del proyecto. Todos los datos fueron procesados conforme a los est√°ndares de integridad y confidencialidad requeridos.

| Sistema                           | √Årea Usuaria         | Tipo | Tecnolog√≠a          | Frecuencia de Actualizaci√≥n | Observaciones                                    |
|-----------------------------------|----------------------|------|---------------------|-----------------------------|------------------------------------------------|
| Sistema de Inventario y Aprovisionamiento | Log√≠stica / Producci√≥n | OLTP | ERP Exactus (Oracle) | 24 horas                    | Maneja stock de telas, hilos y accesorios       |
| Sistema de Control de Calidad     | Producci√≥n / Calidad | OLTP | ERP Exactus (Oracle) | 24 horas                    | Registra prendas aprobadas/rechazadas           |
| Sistema de Costura y Producci√≥n   | Producci√≥n           | OLTP | ERP Exactus (Oracle) | 24 horas                    | Mide productividad, tiempos y residuos          |
| Sistema de Acabado y Embalaje     | Producci√≥n / Log√≠stica | OLTP | ERP Exactus (Oracle) | 24 horas                    | Registra prendas terminadas, costos de embalaje |
| Sistema de Distribuci√≥n y Log√≠stica | Log√≠stica          | OLTP | ERP Exactus (Oracle) | 24 horas                    | Controla despachos, costos log√≠sticos           |
| Sistema de Gesti√≥n de Tecnolog√≠a y Equipos | Mantenimiento   | OLTP | ERP Exactus (Oracle) | 24 horas                    | Reportes de mantenimiento y fallas              |
| Sistema de Recursos Humanos y Capacitaci√≥n | RRHH           | OLTP | ERP Exactus (Oracle) | 24 horas                    | Productividad del personal y capacitaci√≥n       |

---

## 10. Evidencia t√©cnica ‚Äì Parte 2




### 10.1. Archivos cargados en HDFS
Seguiremos los siguientes pasos:
1. Creamos el archivo donde guardaremos el proyecto "Sistema_Inteligencia_Negocios_25-2"
2. Convertimos nuestros archivos excel donde tenemos la informacion en archivos csv
3. Procedemos a subir cada archivo al HDFS.
<img width="891" height="360" alt="image" src="Captura de pantalla 2025-10-01 114534.png" />

### 10.2. Scripts CREATE EXTERNAL TABLE en Hive

Para realizar las consultas en Hive, nos dirigimos a la opcion "Hive View", como se muestra en la imagen:

<img width="891" height="360" alt="image" src="Captura de pantalla 2025-10-01 114607.png" />

A continuaci√≥n, un ejemplo del script utilizado para crear tablas externas en Hive:

```sql
CREATE EXTERNAL TABLE detalle_produccion_costura (
    ORDEN_PRODUCCION STRING,
    SECUENCIA_PAQUETE INT,
    ESTILO STRING,
    TALLA STRING,
    PRENDAS INT,
    FECHA_TERMINO TIMESTAMP
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
LOCATION '/Sistema_Inteligencia_Negocios_25-2/detalle-produccion-costura/'
TBLPROPERTIES ("skip.header.line.count"="1");
';
```

---

### 10.3. Resultados de consulta simple
Queremos saber que tipo de producto se vendio mas, para ser mas precisos los 5 con mas ventas.
Para ello hacemos la siguiente consulta:
```sql
SELECT categoria_producto, SUM(ventas) AS total_ventas
FROM detalle_produccion_costura
GROUP BY categoria_producto
ORDER BY total_ventas DESC
LIMIT 5;
```

Con lo cual nos sale la siguiente tabla:
<img width="891" height="360" alt="image" src="Captura de pantalla 2025-10-01 113649.png" />

---

## 11. Dise√±o del proceso ETL

El proceso **ETL (Extract, Transform, Load)** se desarroll√≥ √≠ntegramente en el entorno **Hortonworks Sandbox**, utilizando las herramientas nativas del ecosistema Hadoop:

- **HDFS** para almacenamiento  
- **Spark** para procesamiento  
- **Hive** como motor de base de datos anal√≠tica

---

### üîÅ Flujo general

Se dise√±√≥ un flujo estructurado que inicia con la extracci√≥n de los reportes Excel proporcionados por el √°rea de producci√≥n y termina con la carga de datos consolidados en tablas Hive, preparadas para an√°lisis y visualizaci√≥n.

El proceso se estructur√≥ en tres fases principales:

---

### üü© 1. Extracci√≥n (Extract)

Se recopilaron los siguientes archivos:

- `detalle-produccion-costura(1).xlsx`
- `detalle-produccion-costura.xlsx`
- `eficiencia.xlsx`
- `produccion-costura-cliente.xlsx`
- `produccion-costura-linea-cliente.xlsx`
- `segundas-prendas.xlsx`

Estos archivos se convirtieron a formato **CSV** y se almacenaron en la ruta `/data/raw/` dentro de **HDFS**, manteniendo carpetas por dataset y fecha de ingesti√≥n:

/data/raw/<nombre_archivo>/ingest_date=YYYYMMDD

### üü® 2. Transformaci√≥n (Transform)

Mediante **Spark (Scala)** se aplicaron reglas de limpieza y estandarizaci√≥n:

- Eliminaci√≥n de registros duplicados por `ORDEN_PRODUCCION` y `SECUENCIA_PAQUETE`
- Normalizaci√≥n de may√∫sculas en campos de texto (`ESTILO`, `TALLA`, `LINEA`)
- Conversi√≥n de fechas al formato ISO (`yyyy-MM-dd`)
- C√°lculo del porcentaje de segundas: PORC_SEGUNDAS = FALLAS_SEGUNDAS / PRENDAS
- Validaci√≥n de campos nulos y eliminaci√≥n de filas incompletas

Los datos limpios se almacenaron temporalmente en la **zona staging** (`/data/staging/`).

---

### üü¶ 3. Carga (Load)

Finalmente, los datos transformados se cargaron en tablas **Hive**, diferenciando dos zonas:

- **Raw layer:** tablas externas sobre los archivos CSV originales  
- **Curated layer:** tablas normalizadas en formato **ORC**, optimizadas para consulta y an√°lisis

Las **particiones por a√±o y mes (anio, mes)** se definieron para la tabla de hechos, mejorando el rendimiento en consultas anal√≠ticas.

El flujo ETL consolid√≥ los reportes dispersos en una estructura uniforme, garantizando **trazabilidad y consistencia** en las m√©tricas de producci√≥n y eficiencia.

---

## üìÇ Fuentes de datos

| Archivo origen | Contenido principal | Campos clave |
|----------------|---------------------|---------------|
| `detalle-produccion-costura(1).xlsx` | Producci√≥n diaria por orden y paquete | ORDEN_PRODUCCION, SECUENCIA_PAQUETE, ESTILO, TALLA, PRENDAS, FECHA_TERMINO |
| `detalle-produccion-costura.xlsx` | Detalle complementario de producci√≥n | ORDEN_PRODUCCION, SECUENCIA_PAQUETE, ESTILO, TALLA, PRENDAS, FECHA_TERMINO |
| `eficiencia.xlsx` | Eficiencia por l√≠nea de costura y fecha | FECHA, LINEA, EFICIENCIA |
| `produccion-costura-cliente.xlsx` | Producci√≥n total por cliente | FECHA, TCODICLIE, PRENDAS |
| `produccion-costura-linea-cliente.xlsx` | Producci√≥n por cliente y l√≠nea | FECHA, LINEA, TCODICLIE, PRENDAS |
| `segundas-prendas.xlsx` | Registro de fallas y prendas observadas | FECHA, INSPECCION_TOTAL, FALLAS_SEGUNDAS, PORC_SEGUNDAS |

Cada archivo fue convertido a **CSV** y almacenado en la **zona raw de HDFS**, dentro de carpetas organizadas por fecha de ingesti√≥n (`ingest_date=YYYYMMDD`).

---

## üß© Zona Staging

Despu√©s de la carga inicial en `/data/raw`, se cre√≥ una zona de **staging** en `/data/staging/`, donde los archivos se procesaron mediante Spark para aplicar limpieza, validaciones y c√°lculos intermedios.

Reglas aplicadas:

- Eliminaci√≥n de duplicados por `ORDEN_PRODUCCION` y `SECUENCIA_PAQUETE`
- Estandarizaci√≥n de formatos de texto (may√∫sculas, eliminaci√≥n de espacios)
- Conversi√≥n de fechas a formato ISO (`yyyy-MM-dd`)
- Validaci√≥n de nulos y exclusi√≥n de filas incompletas
- C√°lculo del porcentaje de segundas (`FALLAS_SEGUNDAS / INSPECCION_TOTAL`)
- Uni√≥n de datos complementarios (producci√≥n, eficiencia, clientes y fallas) en una estructura integrada

El resultado fue almacenado temporalmente en formato **Parquet**, para su posterior carga en las tablas finales del **Data Warehouse**.

---

## ‚öôÔ∏è Reglas de negocio

1. **Integridad de producci√≥n:** una fila es v√°lida solo si contiene `ORDEN_PRODUCCION`, `FECHA_TERMINO` y `PRENDAS > 0`.  
2. **Homogeneizaci√≥n de claves:** unificaci√≥n de c√≥digos de cliente (`TCODICLIE`) y l√≠neas de costura bajo una nomenclatura √∫nica.  
3. **C√°lculo de indicadores:**
 - `EFICIENCIA_PROMEDIO` por l√≠nea y fecha  
 - `% SEGUNDAS` por d√≠a  
 - Total de prendas por cliente y estilo  
4. **Trazabilidad:** se registr√≥ la fecha de ingesti√≥n (`ingest_date`) y el lote de carga.

---

## üíæ Carga final

En la fase final, los datos transformados se cargaron en Hive, distribuidos en dos esquemas:

- **dw_raw:** tablas externas apuntando a los CSV originales  
- **dw_curated:** tablas limpias y normalizadas en formato **ORC**, listas para an√°lisis y construcci√≥n del **cubo OLAP**

Las tablas de la capa curated fueron **particionadas por a√±o y mes (anio, mes)** para optimizar las consultas.

Antes de habilitar el acceso al dashboard, se ejecutaron consultas de verificaci√≥n de conteos y validaciones de integridad.

---

## 12. Scripts de Extracci√≥n y Carga

El desarrollo de los scripts se realiz√≥ completamente dentro del entorno **Hortonworks Sandbox**, empleando **Hive** para la creaci√≥n de tablas externas y **Spark (Scala)** para la limpieza, transformaci√≥n y carga hacia la zona *Curated*.

---

### 12.1 Creaci√≥n de bases de datos

```sql
CREATE DATABASE IF NOT EXISTS dw_raw;
CREATE DATABASE IF NOT EXISTS dw_curated;
```

---

### 12.2 Tablas RAW (HiveQL)

#### a) detalle_produccion_costura
```sql
USE dw_raw;

CREATE EXTERNAL TABLE IF NOT EXISTS detalle_produccion_costura (
  ORDEN_PRODUCCION STRING,
  SECUENCIA_PAQUETE STRING,
  ESTILO STRING,
  TALLA STRING,
  PRENDAS INT,
  FECHA_TERMINO STRING
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
WITH SERDEPROPERTIES ("separatorChar" = ",")
LOCATION '/data/raw/detalle_produccion_costura/';
```

#### b) eficiencia
```sql
CREATE EXTERNAL TABLE IF NOT EXISTS eficiencia (
  FECHA STRING,
  LINEA STRING,
  EFICIENCIA DOUBLE
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
WITH SERDEPROPERTIES ("separatorChar" = ",")
LOCATION '/data/raw/eficiencia/';
```

#### c) produccion_costura_cliente
```sql
CREATE EXTERNAL TABLE IF NOT EXISTS produccion_costura_cliente (
  FECHA STRING,
  TCODICLIE STRING,
  PRENDAS INT
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
LOCATION '/data/raw/produccion_costura_cliente/';
```

#### d) produccion_costura_linea_cliente
```sql
CREATE EXTERNAL TABLE IF NOT EXISTS produccion_costura_linea_cliente (
  FECHA STRING,
  LINEA STRING,
  TCODICLIE STRING,
  PRENDAS INT
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
LOCATION '/data/raw/produccion_costura_linea_cliente/';
```

#### e) segundas_prendas
```sql
CREATE EXTERNAL TABLE IF NOT EXISTS segundas_prendas (
  FECHA STRING,
  INSPECCION_TOTAL INT,
  FALLAS_SEGUNDAS INT,
  PORC_SEGUNDAS DOUBLE
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
LOCATION '/data/raw/segundas_prendas/';
```

---

### 12.3 Transformaciones (Spark - Scala)

```scala
import org.apache.spark.sql.SparkSession
import org.apache.spark.sql.functions._

val spark = SparkSession.builder()
  .appName("Transformacion Produccion Costura")
  .enableHiveSupport()
  .getOrCreate()

// Lectura de los datasets raw
val detalle = spark.read.option("header", "true").csv("/data/raw/detalle_produccion_costura/")
val eficiencia = spark.read.option("header", "true").csv("/data/raw/eficiencia/")
val cliente = spark.read.option("header", "true").csv("/data/raw/produccion_costura_cliente/")
val lineaCliente = spark.read.option("header", "true").csv("/data/raw/produccion_costura_linea_cliente/")
val segundas = spark.read.option("header", "true").csv("/data/raw/segundas_prendas/")

// Limpieza y normalizaci√≥n
val detalleClean = detalle
  .withColumn("ESTILO", upper(trim(col("ESTILO"))))
  .withColumn("TALLA", upper(trim(col("TALLA"))))
  .withColumn("FECHA_TERMINO", to_date(col("FECHA_TERMINO"), "yyyy-MM-dd"))
  .dropDuplicates("ORDEN_PRODUCCION", "SECUENCIA_PAQUETE")

val eficienciaClean = eficiencia
  .withColumn("FECHA", to_date(col("FECHA"), "yyyy-MM-dd"))
  .withColumn("LINEA", upper(trim(col("LINEA"))))

val segundasClean = segundas
  .withColumn("FECHA", to_date(col("FECHA"), "yyyy-MM-dd"))
  .withColumn("PORC_SEGUNDAS",
      when(col("INSPECCION_TOTAL") > 0, col("FALLAS_SEGUNDAS") / col("INSPECCION_TOTAL"))
      .otherwise(lit(null))
  )

// Almacenamiento temporal en staging
detalleClean.write.mode("overwrite").parquet("/data/staging/detalle_produccion_costura/")
eficienciaClean.write.mode("overwrite").parquet("/data/staging/eficiencia/")
segundasClean.write.mode("overwrite").parquet("/data/staging/segundas_prendas/")

spark.stop()
```

---

### 12.4 Creaci√≥n de tablas Curated (HiveQL)

```sql
USE dw_curated;

-- Dimensi√≥n Tiempo
CREATE TABLE IF NOT EXISTS dim_tiempo (
  id_tiempo INT,
  fecha DATE,
  dia INT,
  mes INT,
  anio INT,
  trimestre INT
)
STORED AS ORC;

-- Dimensi√≥n L√≠nea
CREATE TABLE IF NOT EXISTS dim_linea (
  id_linea INT,
  nombre_linea STRING
)
STORED AS ORC;

-- Dimensi√≥n Producto
CREATE TABLE IF NOT EXISTS dim_producto (
  id_producto INT,
  estilo STRING,
  talla STRING
)
STORED AS ORC;

-- Dimensi√≥n Cliente
CREATE TABLE IF NOT EXISTS dim_cliente (
  id_cliente INT,
  tcodiclie STRING
)
STORED AS ORC;

-- Tabla de Hechos
CREATE TABLE IF NOT EXISTS fact_produccion (
  orden_produccion STRING,
  secuencia_paquete STRING,
  id_producto INT,
  id_linea INT,
  id_cliente INT,
  prendas INT,
  eficiencia DOUBLE,
  fallas_segundas INT,
  porc_segundas DOUBLE,
  fecha_termino DATE
)
PARTITIONED BY (anio INT, mes INT)
STORED AS ORC;
```

---

### 12.5 Carga de datos a tablas Curated

```sql
INSERT OVERWRITE TABLE dw_curated.fact_produccion PARTITION (anio, mes)
SELECT
  d.ORDEN_PRODUCCION,
  d.SECUENCIA_PAQUETE,
  NULL AS id_producto,
  NULL AS id_linea,
  c.id_cliente,
  d.PRENDAS,
  e.EFICIENCIA,
  s.FALLAS_SEGUNDAS,
  s.PORC_SEGUNDAS,
  d.FECHA_TERMINO,
  year(d.FECHA_TERMINO) AS anio,
  month(d.FECHA_TERMINO) AS mes
FROM dw_raw.detalle_produccion_costura d
LEFT JOIN dw_raw.eficiencia e ON d.FECHA_TERMINO = e.FECHA
LEFT JOIN dw_raw.produccion_costura_cliente c ON d.FECHA_TERMINO = c.FECHA
LEFT JOIN dw_raw.segundas_prendas s ON d.FECHA_TERMINO = s.FECHA;
```

---

### 12.6 Validaciones y evidencias

```sql
DESCRIBE FORMATTED dw_curated.fact_produccion;
SHOW PARTITIONS dw_curated.fact_produccion;
SELECT COUNT(*) FROM dw_curated.fact_produccion;
SELECT SUM(prendas) FROM dw_curated.fact_produccion;
SELECT AVG(eficiencia) FROM dw_curated.fact_produccion;
```

## 13. Tablas en Hive

La estructura final implementada en **Hive** se resume en la siguiente tabla:

| Tabla | Tipo | Particiones | Formato |
|--------|------|--------------|----------|
| dw_raw.detalle_produccion_costura | Raw | ingest_date | CSV |
| dw_raw.eficiencia | Raw | ingest_date | CSV |
| dw_raw.produccion_costura_cliente | Raw | ingest_date | CSV |
| dw_raw.segundas_prendas | Raw | ingest_date | CSV |
| dw_curated.dim_tiempo | Curated | ‚Äî | ORC |
| dw_curated.dim_linea | Curated | ‚Äî | ORC |
| dw_curated.dim_producto | Curated | ‚Äî | ORC |
| dw_curated.dim_cliente | Curated | ‚Äî | ORC |
| dw_curated.fact_produccion | Curated | anio, mes | ORC |

### Evidencias

Se ejecutaron los siguientes comandos de validaci√≥n:

```sql
DESCRIBE FORMATTED dw_curated.fact_produccion;
SHOW PARTITIONS dw_curated.fact_produccion;
SELECT COUNT(*) FROM dw_curated.fact_produccion;
SELECT SUM(prendas)
FROM dw_curated.fact_produccion
WHERE anio = 2025 AND mes = 10;
```

Los resultados confirmaron la correcta carga y estructura de las tablas en Hive.

---

## 14. Cubo OLAP

Con las tablas normalizadas se dise√±√≥ un **cubo OLAP** sobre la tabla de hechos `dw_curated.fact_produccion`, complementada por las dimensiones `dim_tiempo`, `dim_linea`, `dim_cliente` y `dim_producto`.

### Estructura del Cubo

- **Tabla de hechos:** `fact_produccion`
- **Dimensiones:** Tiempo, L√≠nea, Cliente, Producto
- **Medidas:**
  - Total de prendas ‚Üí `SUM(prendas)`
  - Eficiencia promedio ‚Üí `AVG(eficiencia)`
  - Total de fallas segundas ‚Üí `SUM(fallas_segundas)`
  - Porcentaje de segundas ‚Üí `AVG(porc_segundas)`

### Ejemplo de consulta OLAP

```sql
SELECT 
    t.mes, 
    l.nombre_linea,
    SUM(f.prendas) AS total_prendas,
    AVG(f.eficiencia) AS eficiencia_prom,
    AVG(f.porc_segundas) AS porc_segundas_prom
FROM dw_curated.fact_produccion f
JOIN dw_curated.dim_tiempo t 
    ON f.anio = t.anio AND f.mes = t.mes
JOIN dw_curated.dim_linea l 
    ON f.id_linea = l.id_linea
GROUP BY t.mes, l.nombre_linea
ORDER BY t.mes;
```

Este cubo permiti√≥ visualizar el desempe√±o mensual por l√≠nea de producci√≥n, identificando tendencias y niveles de eficiencia.

---

## 15. Dashboard Preliminar

Para la visualizaci√≥n de los resultados se elabor√≥ un **dashboard en Power BI**, conectado directamente al servidor **Hive** del **Hortonworks Sandbox**.

### Componentes del Dashboard

1. **Vista acumulativa de producci√≥n**
   - L√≠nea temporal de producci√≥n total.
   - Filtros: L√≠nea, Cliente, Estilo.

2. **Vista acumulativa de calidad**
   - Porcentaje acumulado de segundas por mes y l√≠nea.
   - Filtros: L√≠nea, Estilo, Mes.

3. **Vista comparativa**
   - Gr√°fico de barras comparando la producci√≥n total y segundas entre el mes actual y el anterior.

4. **KPI destacado con sem√°foro**
   - Eficiencia promedio mensual:
     - üü¢ Verde: > 80%
     - üü° Amarillo: 70‚Äì80%
     - üî¥ Rojo: < 70%

---

## 16. Limitaciones y Propuesta de Mejora

### Limitaciones

- Las fuentes originales en Excel presentaban diferencias de formato y errores tipogr√°ficos que requirieron limpieza manual.  
- El entorno **Hortonworks Sandbox** se ejecut√≥ en una m√°quina virtual local, limitando los recursos de procesamiento.  
- La conversi√≥n de archivos Excel a CSV se realiz√≥ de forma semi-manual.  
- No se cont√≥ con un orquestador de flujos (*Airflow* o *NiFi*) para automatizar completamente el ETL.  
- El cubo OLAP fue implementado a nivel l√≥gico en Hive; no se integr√≥ a√∫n un motor OLAP dedicado.

### Propuestas de Mejora

- Implementar **Apache NiFi** para automatizar la carga de archivos y controlar la ingesti√≥n desde el origen.  
- Migrar el entorno a un **cl√∫ster Hadoop distribuido**, aumentando la capacidad de procesamiento.  
- Incorporar un motor OLAP como **Apache Kylin** o **Druid** para generar cubos con consultas multidimensionales en tiempo real.  
- Crear un **cat√°logo maestro de productos y clientes** para mejorar la integridad referencial.  
- Programar **validaciones autom√°ticas** entre tablas *raw* y *curated* para detectar discrepancias en las cargas diarias.

---
## Bibliograf√≠a  

- [Tableau ‚Äì Visualizaci√≥n de datos](https://www.tableau.com/es-es/blog)  
- [Microsoft Power BI Docs](https://docs.microsoft.com/es-es/power-bi/)  
- [Datascope ‚Äì BI en diversos sectores](https://datascope.io/es/blog/)  
- [IBM ‚Äì Business Intelligence](https://www.ibm.com/blogs/systems/es-es/tag/business-intelligence/)  
- [Ceintec ‚Äì Inteligencia de negocios y Big Data](http://www.ceintec.com/inteligencia-de-negocios-y-big-data)
